:root {
  --bg-main:#000000;
  --surface:#1a1a1a;
  --surface-border:#2a2a2a;
  --bubble-user:#2a2a2a;
  --bubble-ai:#1f1f1f;
  --text-primary:#ffffff;
  --text-muted:#9ca3af;
  --accent:#FFB906;
  --accent-text:#000000;
  --radius-xl:28px;
  --radius-lg:14px;
  --radius-md:10px;
  --shadow-bar:0 20px 40px rgba(0,0,0,.8);
  --shadow-bubble:0 16px 32px rgba(0,0,0,.7);
  --record-red:#ff4d4d;
  --record-glow:rgba(255,77,77,.7);
}

/* reset */
* {
  box-sizing:border-box;
  -webkit-font-smoothing:antialiased;
}

/* PAGE IS NOW SCROLLABLE LIKE NORMAL */
body {
  margin:0;
  background:var(--bg-main);
  color:var(--text-primary);
  font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Arial;

  /* allow normal scrolling */
  min-height:100dvh;
  display:flex;
  flex-direction:column;
  overflow-y:auto;
}

/* page wrapper centers content and applies max-width */
.page {
  width:100%;
  max-width:900px;
  margin:0 auto;
  padding:24px 16px 120px;
  position:relative;
  display:flex;
  flex-direction:column;
}

/* =========================================================
   HERO (landing screen before chat starts)
   ========================================================= */
.hero {
  width:100%;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;

  min-height:50vh;
  text-align:center;
  transition:
    opacity .2s ease,
    max-height .2s ease,
    margin .2s ease;
}

.hero-headline {
  margin:0 0 24px;
  font-size:32px;
  font-weight:600;
  color:var(--text-primary);
  line-height:1.2;
}

.hero-composer {
  display:flex;
  justify-content:center;
  width:100%;
}
.hero-composer .composer-bar {
  width:min(760px,90%);
  max-width:760px;
}

/* after chat starts, hide hero */
body.has-started .hero {
  opacity:0;
  max-height:0;
  margin:0;
  overflow:hidden;
}
body.has-started .hero-composer {
  display:none;
}

/* =========================================================
   NEW: CONTINUE BANNER
   ========================================================= */
.continue-banner {
  background:linear-gradient(135deg, rgba(255,185,6,.1), rgba(255,185,6,.05));
  border:1px solid rgba(255,185,6,.3);
  border-radius:var(--radius-md);
  padding:12px 16px;
  margin-bottom:24px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:14px;
  animation:slideInDown 0.3s ease;
}

.continue-banner button {
  background:var(--accent);
  color:var(--accent-text);
  border:none;
  border-radius:6px;
  padding:6px 12px;
  font-size:13px;
  font-weight:500;
  cursor:pointer;
  transition:.15s ease;
}

.continue-banner button:hover {
  filter:brightness(1.1);
}

@keyframes slideInDown {
  from {
    opacity:0;
    transform:translateY(-20px);
  }
  to {
    opacity:1;
    transform:translateY(0);
  }
}

/* =========================================================
   DOCKED / STICKY COMPOSER
   ========================================================= */

.dock-composer {
  position:sticky;
  bottom:0;
  left:0;
  right:0;

  background:var(--bg-main);
  border-top:1px solid var(--surface-border);

  padding:16px 16px 24px;
  display:flex;
  justify-content:center;
  z-index:50;

  /* hidden until chat actually starts */
  visibility:hidden;
  opacity:0;
  pointer-events:none;
  transition:opacity .2s ease;
}

.dock-composer .composer-bar {
  max-width:760px;
  width:100%;
}

body.has-started .dock-composer {
  visibility:visible;
  opacity:1;
  pointer-events:auto;
}

body.hero-mode .dock-composer {
  visibility:hidden;
  opacity:0;
  pointer-events:none;
}

/* =========================================================
   COMPOSER BAR (shared styles for hero + dock)
   ========================================================= */
.composer-bar {
  display:flex;
  align-items:center;
  gap:12px;
  background:var(--surface);
  border:1px solid var(--surface-border);
  border-radius:var(--radius-xl);
  padding:14px 16px;
  box-shadow:var(--shadow-bar);
  color:var(--text-primary);
  position:relative;
}

.icon-btn {
  width:40px;
  height:40px;
  display:grid;
  place-items:center;
  border-radius:var(--radius-md);
  border:1px solid transparent;
  background:transparent;
  color:var(--text-primary);
  cursor:pointer;
  transition:.15s ease;
}
.icon-btn svg {
  width:20px;
  height:20px;
  color:currentColor;
}

.attach-btn,
.mic-btn,
.send-btn {
  flex-shrink:0;
}

/* send button (orange) */
.send-btn {
  background:var(--accent);
  color:var(--accent-text);
  border-color:var(--accent);
  border-radius:var(--radius-md);
  font-weight:500;
  min-width:40px;
}
.send-btn:hover {
  filter:brightness(1.05);
}

/* mic idle */
.mic-btn {
  background:transparent;
  border-color:transparent;
  color:var(--text-primary);
  position:relative;
}
.mic-btn:hover {
  color:var(--accent);
}

/* NEW: Waveform visualization */
.waveform {
  position:absolute;
  bottom:-4px;
  left:50%;
  transform:translateX(-50%) scaleX(1);
  width:30px;
  height:3px;
  background:var(--record-red);
  border-radius:2px;
  opacity:0;
  transition:transform .1s ease, opacity .2s ease;
}

.mic-wrap.recording .waveform {
  opacity:1;
}

/* mic recording glow */
.mic-wrap.recording {
  box-shadow:
    0 0 16px var(--record-glow),
    0 12px 32px rgba(0,0,0,.9);
  border-radius:var(--radius-md);
  outline:2px solid var(--record-red);
  outline-offset:2px;
}
.mic-btn.recording svg {
  color:var(--record-red);
  filter:drop-shadow(0 0 6px var(--record-glow));
}

/* textarea */
.composer-bar textarea {
  flex:1;
  background:transparent;
  border:0;
  color:var(--text-primary);
  font-size:16px;
  line-height:1.4;
  resize:none;
  outline:0;
  padding:8px 0;
  min-height:24px;
  max-height:140px;
}
.composer-bar textarea::placeholder {
  color:var(--text-muted);
}

/* send / mic swap */
#send,
#send-docked {
  display:none;
}
.typing-mode .right #send,
.typing-mode .right #send-docked {
  display:grid;
}
.typing-mode .right #micWrap,
.typing-mode .right #micWrap-docked {
  display:none;
}

/* =========================================================
   MESSAGES
   ========================================================= */

.messages {
  display:flex;
  flex-direction:column;
  gap:16px;
  max-width:760px;
  width:100%;
  margin:0 auto 40px auto;
  position:relative;
  z-index:1;
}

/* bubbles */
.msg {
  max-width:80%;
  padding:12px 16px;
  border-radius:var(--radius-lg);
  font-size:15px;
  line-height:1.4;
  box-shadow:var(--shadow-bubble);
  white-space:pre-wrap;
  word-break:break-word;
  border:1px solid transparent;
  color:var(--text-primary);
  animation:fadeInUp 0.3s ease;
}

@keyframes fadeInUp {
  from {
    opacity:0;
    transform:translateY(10px);
  }
  to {
    opacity:1;
    transform:translateY(0);
  }
}

.msg.user {
  align-self:flex-end;
  background:var(--bubble-user);
  border-color:#3a3a3a;
}

.msg.assistant {
  align-self:flex-start;
  background:var(--bubble-ai);
  border-color:#2a2a2a;
}

.msg.assistant a {
  color:var(--accent);
  text-decoration:underline;
}

.msg.thinking {
  opacity:.6;
  font-style:italic;
}

/* NEW: Typing indicator animation */
.msg.typing-indicator {
  max-width:60px;
  padding:16px 20px;
  display:flex;
  gap:6px;
  align-items:center;
  justify-content:center;
}

.typing-indicator span {
  width:8px;
  height:8px;
  border-radius:50%;
  background:var(--accent);
  opacity:.4;
  animation:typing-bounce 1.4s infinite ease-in-out;
}

.typing-indicator span:nth-child(1) {
  animation-delay:0s;
}

.typing-indicator span:nth-child(2) {
  animation-delay:.2s;
}

.typing-indicator span:nth-child(3) {
  animation-delay:.4s;
}

@keyframes typing-bounce {
  0%, 60%, 100% {
    transform:translateY(0);
    opacity:.4;
  }
  30% {
    transform:translateY(-10px);
    opacity:1;
  }
}

/* listening bubble */
.msg.system {
  align-self:flex-start;
  background:#111;
  color:var(--accent);
  border:1px solid rgba(255,185,6,.4);
  border-radius:var(--radius-lg);
  font-size:14px;
  font-style:italic;
  line-height:1.4;
  padding:12px 16px;
  display:flex;
  align-items:center;
  gap:6px;
}

.listening-dots::after {
  content:"";
  display:inline-block;
  width:2ch;
  text-align:left;
  color:var(--accent);
  animation:dots-step 1s steps(4,end) infinite;
}
@keyframes dots-step {
  0%   { content:""; }
  25%  { content:"."; }
  50%  { content:".."; }
  75%  { content:"..."; }
  100% { content:""; }
}

/* =========================================================
   NEW: SCROLL TO BOTTOM BUTTON
   ========================================================= */
.scroll-to-bottom {
  position:fixed;
  bottom:120px;
  right:24px;
  width:48px;
  height:48px;
  background:var(--surface);
  border:1px solid var(--surface-border);
  border-radius:50%;
  display:none;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  box-shadow:0 8px 24px rgba(0,0,0,.6);
  transition:.2s ease;
  z-index:40;
  color:var(--text-primary);
}

.scroll-to-bottom:hover {
  background:var(--accent);
  color:var(--accent-text);
  transform:translateY(-2px);
  box-shadow:0 12px 32px rgba(0,0,0,.8);
}

.scroll-to-bottom svg {
  width:20px;
  height:20px;
}

/* =========================================================
   NEW: HISTORY SIDEBAR
   ========================================================= */
.history-btn {
  position:fixed;
  top:24px;
  right:24px;
  width:48px;
  height:48px;
  background:var(--surface);
  border:1px solid var(--surface-border);
  border-radius:var(--radius-md);
  display:grid;
  place-items:center;
  cursor:pointer;
  box-shadow:0 4px 12px rgba(0,0,0,.5);
  transition:.2s ease;
  z-index:45;
  color:var(--text-primary);
}

.history-btn:hover {
  background:var(--accent);
  color:var(--accent-text);
  transform:scale(1.05);
}

.history-btn svg {
  width:20px;
  height:20px;
}

.history-sidebar {
  position:fixed;
  top:0;
  right:0;
  width:min(340px, 85vw);
  height:100vh;
  background:var(--surface);
  border-left:1px solid var(--surface-border);
  box-shadow:-8px 0 32px rgba(0,0,0,.7);
  transform:translateX(100%);
  transition:transform .3s ease;
  z-index:60;
  display:flex;
  flex-direction:column;
}

.history-sidebar.open {
  transform:translateX(0);
}

.history-header {
  padding:20px;
  border-bottom:1px solid var(--surface-border);
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.history-header h2 {
  margin:0;
  font-size:18px;
  font-weight:600;
}

.history-close {
  background:transparent;
  border:none;
  color:var(--text-muted);
  cursor:pointer;
  font-size:24px;
  line-height:1;
  padding:4px 8px;
  transition:.15s ease;
}

.history-close:hover {
  color:var(--text-primary);
}

.history-list {
  flex:1;
  overflow-y:auto;
  padding:8px;
}

.history-item {
  padding:12px 16px;
  margin-bottom:8px;
  background:rgba(255,255,255,.03);
  border:1px solid transparent;
  border-radius:var(--radius-md);
  cursor:pointer;
  transition:.15s ease;
}

.history-item:hover {
  background:rgba(255,255,255,.06);
  border-color:var(--surface-border);
}

.history-item.active {
  background:rgba(255,185,6,.1);
  border-color:rgba(255,185,6,.3);
}

.history-preview {
  font-size:14px;
  line-height:1.4;
  color:var(--text-primary);
  margin-bottom:6px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.history-date {
  font-size:12px;
  color:var(--text-muted);
}

/* =========================================================
   NEW: PLAYBACK SPEED CONTROL
   ========================================================= */
.playback-controls {
  position:fixed;
  bottom:180px;
  right:24px;
  background:var(--surface);
  border:1px solid var(--surface-border);
  border-radius:var(--radius-md);
  padding:12px 16px;
  box-shadow:0 8px 24px rgba(0,0,0,.6);
  display:none;
  flex-direction:column;
  gap:8px;
  z-index:40;
  min-width:160px;
}

body.has-started .playback-controls {
  display:flex;
}

.playback-controls label {
  font-size:12px;
  color:var(--text-muted);
  text-transform:uppercase;
  letter-spacing:.5px;
  font-weight:500;
}

.playback-controls select {
  background:var(--bg-main);
  color:var(--text-primary);
  border:1px solid var(--surface-border);
  border-radius:6px;
  padding:6px 10px;
  font-size:14px;
  cursor:pointer;
  outline:none;
}

.playback-controls select:hover {
  border-color:var(--accent);
}

/* =========================================================
   CALENDAR MODAL
   ========================================================= */
.cal-modal {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  padding:16px;
  z-index:100;
}
.cal-modal.open {
  display:flex;
}
.cal-dialog {
  background:#111;
  color:var(--text-primary);
  width:min(500px,100%);
  max-height:90vh;
  overflow:auto;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.08);
  box-shadow:0 30px 70px rgba(0,0,0,.7);
  padding:16px;
  position:relative;
  font-size:14px;
}
.cal-close {
  position:absolute;
  top:8px;
  right:8px;
  background:#1f1f1f;
  border:0;
  color:var(--text-primary);
  border-radius:8px;
  cursor:pointer;
  line-height:1;
  padding:6px 8px;
  font-size:12px;
}
.cal-inline {
  min-height:400px;
}
.cal-fallback-wrap {
  font-size:13px;
  margin-top:12px;
}
.cal-fallback-wrap a {
  color:var(--accent);
  text-decoration:underline;
}

/* =========================================================
   RESPONSIVE
   ========================================================= */
@media(max-width:600px){
  .hero-headline {
    font-size:28px;
  }
  .composer-bar {
    border-radius:20px;
  }
  .msg {
    max-width:90%;
    font-size:14px;
  }
  .scroll-to-bottom {
    bottom:100px;
    right:16px;
    width:44px;
    height:44px;
  }
  .history-btn {
    top:16px;
    right:16px;
    width:44px;
    height:44px;
  }
  .playback-controls {
    bottom:160px;
    right:16px;
  }
}